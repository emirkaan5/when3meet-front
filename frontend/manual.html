<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>When3Meet – Add Availability</title>
  <style>
    :root {
      --purple: #996899;
      --border: #e6e6f0;
      --text: #1a1a1a;
      --muted: #6b7280;
      --gridline: #f0f0fa;
      --active: #E3C5E3;
      --col-width: 180px;
      --cell-h: 26px;
    }

    * { box-sizing: border-box; }

    body {
      margin: 0;
      font-family: "Inter", system-ui, -apple-system, Segoe UI, Roboto, sans-serif;
      color: var(--text);
      background: #fafafa;
      display: flex;
      justify-content: center;
      padding: 48px 0;
    }

    .container {
      width: min(1100px, 96vw);
      display: grid;
      grid-template-columns: 1fr 220px;
      gap: 40px;
    }

    .main {
      background: #fff;
      border-radius: 12px;
      padding: 24px 40px 36px;
      box-shadow: 0 1px 3px rgba(0, 0, 0, 0.06);
    }

    .header {
      display: flex;
      justify-content: space-between;
      align-items: flex-start;
      margin-bottom: 20px;
    }

    .header-left h1 { margin: 0; font-size: 22px; font-weight: 600; }
    .header-left span { color: var(--muted); font-size: 14px; }
    .header-right { display: flex; gap: 10px; }

    .btn {
      border-radius: 8px;
      padding: 8px 14px;
      font-size: 14px;
      cursor: pointer;
      border: 1px solid #ccc;
      background: #fff;
      color: #333;
      transition: background 0.2s;
    }

    .btn:hover { background: #f2f2f2; }
    .btn.primary { background: var(--purple); color: #fff; border: none; }
    .btn.primary:hover { background: #c38bc3; }

    .schedule {
      display: grid;
      grid-template-columns: 60px 1fr;
      align-items: start;
      column-gap: 36px;
    }

    .time-labels {
      position: relative;
      font-size: 13px;
      color: var(--muted);
    }

    .time-label {
      position: absolute;
      right: 0;
      transform: translateY(-50%);
      font-weight: 500;
    }

    .day-columns {
      display: flex;
      gap: 36px;
      overflow-x: auto;
    }

    .day-column {
      display: flex;
      flex-direction: column;
      align-items: stretch;
      width: var(--col-width);
    }

    .day-header { text-align: center; margin-bottom: 8px; }
    .day-header span { display: block; color: var(--muted); font-size: 13px; }
    .day-header h3 { margin: 2px 0 0; font-size: 15px; font-weight: 600; }

    .day-grid {
      display: grid;
      grid-auto-rows: var(--cell-h);
      border: 1px solid var(--border);
      border-radius: 6px;
      overflow: hidden;
      background: #fff;
      width: 100%;
    }

    .cell {
      border-bottom: 1px solid var(--gridline);
      background: #fff;
      cursor: pointer;
      transition: background 0.15s;
    }

    .cell.active { background: var(--active); }
    .cell:last-child { border-bottom: none; }

    .sidebar { padding-top: 48px; }
    .responses-box {
      background: #fff;
      border: 1px solid #e5e7eb;
      border-radius: 8px;
      padding: 16px;
      font-size: 14px;
    }

    .responses-box h3 { margin: 0 0 8px; font-size: 15px; font-weight: 500; }
    .muted { color: var(--muted); font-size: 13px; }

    .timezone-bar {
      display: flex;
      justify-content: flex-start;
      align-items: center;
      gap: 12px;
      margin-top: 18px;
      font-size: 13px;
      color: var(--muted);
    }

    .select {
      border: none;
      border-bottom: 1px solid #ddd;
      background: transparent;
      font-size: 13px;
      padding: 2px 0;
      color: var(--muted);
    }

    /* Modern Modal */
    .modal {
      position: fixed;
      top: 0; left: 0;
      width: 100%; height: 100%;
      background: rgba(0, 0, 0, 0.25);
      display: flex;
      justify-content: center;
      align-items: center;
      visibility: hidden;
      opacity: 0;
      transition: opacity 0.25s ease, visibility 0.25s ease;
      z-index: 1000;
    }

    .modal.show {
      visibility: visible;
      opacity: 1;
    }

    .modal-card {
      background: #fff;
      border-radius: 16px;
      padding: 28px 32px 32px;
      box-shadow: 0 4px 20px rgba(0, 0, 0, 0.08);
      width: 340px;
      text-align: center;
      animation: fadeInUp 0.25s ease;
    }

    .modal-card h3 {
      font-size: 18px;
      font-weight: 600;
      margin-bottom: 16px;
    }

    .modal-card input {
      width: 100%;
      padding: 10px 12px;
      border: 1px solid #dcdcdc;
      border-radius: 8px;
      font-size: 14px;
      margin-bottom: 20px;
      transition: border-color 0.2s, box-shadow 0.2s;
    }

    .modal-card input:focus {
      outline: none;
      border-color: var(--purple);
      box-shadow: 0 0 0 3px rgba(218,167,218,0.2);
    }

    .modal-card button {
      width: 100%;
      background: var(--purple);
      border: none;
      color: #fff;
      padding: 10px;
      border-radius: 8px;
      font-weight: 600;
      cursor: pointer;
      transition: background 0.2s ease;
    }

    .modal-card button:hover { background: #c38bc3; }

    @keyframes fadeInUp {
      from { opacity: 0; transform: translateY(15px); }
      to { opacity: 1; transform: translateY(0); }
    }
  </style>
</head>

<body>
  <div class="container">
    <div class="main">
      <div class="header">
        <div class="header-left">
          <h1 id="eventName">Loading...</h1>
          <span id="eventDates">--</span>
        </div>
        <div class="header-right">
          <button class="btn" id="copyLink">Copy link</button>
          <button class="btn primary" id="addAvailability">Add availability</button>
        </div>
      </div>

      <div class="schedule">
        <div class="time-labels" id="timeLabels"></div>
        <div class="day-columns" id="dayColumns"></div>
      </div>

      <div class="timezone-bar">
        <span>Shown in</span>
        <select class="select">
          <option>(GMT-4:00) Eastern Time (US & Canada)</option>
        </select>
        <select class="select">
          <option>12h</option>
          <option>24h</option>
        </select>
      </div>
    </div>

    <div class="sidebar">
      <div class="responses-box">
        <h3 id="responseHeader">Responses (0/0)</h3>
        <ul id="responseList" class="muted" style="padding-left: 18px; margin: 8px 0 0;"></ul>
      </div>
    </div>
  </div>

  <!-- Beautiful name modal -->
  <div class="modal" id="nameModal">
    <div class="modal-card">
      <h3>Enter your name</h3>
      <input type="text" id="userName" placeholder="Your name" />
      <button id="saveAvailability">Save my availability</button>
    </div>
  </div>

  <script>
    const eventData = JSON.parse(localStorage.getItem("eventData"));
    const responses = JSON.parse(localStorage.getItem("responses") || "{}");

    function renderResponses() {
      const list = document.getElementById("responseList");
      const header = document.getElementById("responseHeader");
      const eventKey = eventData?.title || "defaultEvent";
      const eventResponses = responses[eventKey] || [];
      list.innerHTML = "";

      eventResponses.forEach(r => {
        const li = document.createElement("li");
        li.textContent = r.name;
        list.appendChild(li);
      });

      header.textContent = `Responses (${eventResponses.length}/${eventResponses.length})`;
    }

    if (eventData) {
      const { title, startTime, endTime, selectedDays, month, year } = eventData;
      document.getElementById("eventName").textContent = title;

      const firstDate = new Date(year, month, Math.min(...selectedDays));
      const lastDate = new Date(year, month, Math.max(...selectedDays));
      document.getElementById("eventDates").textContent =
        firstDate.toLocaleDateString("en-US", { month: "short", day: "numeric", year: "numeric" }) +
        (selectedDays.length > 1
          ? " – " +
            lastDate.toLocaleDateString("en-US", { month: "short", day: "numeric", year: "numeric" })
          : "");

      const startH = parseInt(startTime.split(":")[0]);
      const endH = parseInt(endTime.split(":")[0]);
      const hours = endH - startH;
      const totalCells = hours * 2;

      const dayColumns = document.getElementById("dayColumns");
      dayColumns.innerHTML = "";
      selectedDays.forEach(dayNum => {
        const dateObj = new Date(year, month, dayNum);
        const col = document.createElement("div");
        col.className = "day-column";

        const head = document.createElement("div");
        head.className = "day-header";
        const weekday = dateObj.toLocaleDateString("en-US", { weekday: "short" });
        const monthDay = dateObj.toLocaleDateString("en-US", { month: "short", day: "numeric" });
        head.innerHTML = `<span>${monthDay}</span><h3>${weekday}</h3>`;
        col.appendChild(head);

        const grid = document.createElement("div");
        grid.className = "day-grid";
        for (let i = 0; i < totalCells; i++) {
          const cell = document.createElement("div");
          cell.className = "cell";
          grid.appendChild(cell);
        }
        col.appendChild(grid);
        dayColumns.appendChild(col);
      });

      // Align time labels
      const timeLabels = document.getElementById("timeLabels");
      const firstGrid = document.querySelector(".day-grid");
      const headerHeight = document.querySelector(".day-header").offsetHeight + 8;
      const cellH = parseFloat(getComputedStyle(firstGrid).getPropertyValue("--cell-h") || 26);
      const topOffset = headerHeight;
      timeLabels.innerHTML = "";

      for (let h = startH; h <= endH; h++) {
        const label = document.createElement("div");
        label.className = "time-label";
        const ampm = h >= 12 ? "PM" : "AM";
        const display = ((h + 11) % 12) + 1;
        label.textContent = `${display} ${ampm}`;
        label.style.top = `${topOffset + (h - startH) * cellH * 2}px`;
        timeLabels.appendChild(label);
      }

      // Drag-select
      let dragging = false;
      let addMode = true;
      const toggle = c => c.classList[addMode ? "add" : "remove"]("active");

      document.querySelectorAll(".cell").forEach(cell => {
        cell.addEventListener("mousedown", () => {
          dragging = true;
          addMode = !cell.classList.contains("active");
          toggle(cell);
        });
        cell.addEventListener("mouseenter", () => dragging && toggle(cell));
      });
      document.addEventListener("mouseup", () => (dragging = false));
    }

    // Copy link
    document.getElementById("copyLink").addEventListener("click", () => {
      navigator.clipboard.writeText(window.location.href);
      alert("Link copied to clipboard!");
    });

    // Add availability modal
    const modal = document.getElementById("nameModal");
    const addBtn = document.getElementById("addAvailability");
    const saveBtn = document.getElementById("saveAvailability");
    const nameInput = document.getElementById("userName");

    addBtn.addEventListener("click", () => {
      modal.classList.add("show");
      nameInput.focus();
    });

    saveBtn.addEventListener("click", () => {
      const name = nameInput.value.trim();
      if (!name) {
        nameInput.style.borderColor = "#e57373";
        nameInput.focus();
        return;
      }

      const selected = [...document.querySelectorAll(".cell.active")].map((c, i) => i);
      const eventKey = eventData?.title || "defaultEvent";
      responses[eventKey] = responses[eventKey] || [];
      responses[eventKey].push({ name, selected });
      localStorage.setItem("responses", JSON.stringify(responses));

      modal.classList.remove("show");
      nameInput.value = "";
      document.querySelectorAll(".cell").forEach(c => c.classList.remove("active"));
      renderResponses();
    });

    renderResponses();
  </script>
</body>
</html>
